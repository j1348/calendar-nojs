<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title></title>
</head>
<body>
    <style>

    .calendars {
        overflow: hidden;
    }

    .calendars-inner {
        width: 500%;
        transition: all 400ms;
        padding-left: 20%;
    }

    .calendars-controls > div {
        margin: 0 auto;
        width: 170px;
    }

    .calendars-controls label {
        cursor: pointer;
        border-radius: 50%;
        display: inline-block;
        width: 30px;
        height: 30px;
        background: #bbb;
        margin: 0.7rem 0.5rem 0.7rem 0;
    }

    .calendars-controls label:hover {
        background: #ccc;
        border-color: #777 !important;
    }




    .calendar-detail {
        font-size: 1.3rem;
    }


    .calendar-detail > div {
        display: none;
        width: 19rem;
        padding: 0.1rem 2rem 2rem 2rem;
        margin: 0 auto;
        background-color: #EEE;
    }

    .calendar-detail .event__name {

    }





    .calendar-nojs {
        display: inline-block;
        font-family: sans-serif;
        border: 1px solid #AAA;
        padding: 0 1rem 1rem;
        font-size: 1.3rem;
    }

    .calendar-nojs thead {
        line-height: 1.6rem;
    }

    .calendar-nojs thead td {
        font-weight: bold;
        text-align: right;
        padding-right: 8%;
    }

    .calendar-nojs tbody td {
        border: 3px solid transparent;
        border-radius: 50%;
        text-align: center;
        vertical-align: middle;
    }

    .calendar-nojs tbody td label {
        margin: 5px;
        width: 1.5rem;
        font-size: 1.5rem;
        display: inline-block;
        
        
    }

    .calendar-nojs tbody td label.event {
        background-color: blue;
        border-radius: 50%;
        color: white;
        cursor: pointer;
            font-size: 1.3rem;
    min-width: 100%;
    line-height: 1.5;
    }

    .calendar-nojs tbody td.previous-month,
    .calendar-nojs tbody td.next-month {
        color: #AAA;
    }

    .calendar-nojs h2 {
        text-align: center;
    }

    .calendar-nojs .category1 {
        border-bottom: 4px solid red;
    }

    .calendar-nojs .category2  {
        border-bottom: 4px solid blue;
    }

    input[type=radio] {
       position: absolute;
       top: -9999px;
       left: -9999px;
    }   


    /* selector for month selection */
    <% for(var k=0; k<months.length; k++) {
        var context = months[k];
        %>
        #<%= context.monthId %>:checked ~ .calendars .calendars-inner {
            margin-left: -<%= k * 24 %>%;
        }

        #<%= context.monthId %>:checked ~ .calendars .calendars-controls label:nth-child(<%= k+1 %>) {
            background-color: blue;
            transform: scale(1.2);
        }
    <% } %>

    /* selector for the events */
    <% for(var k=0; k<events.length; k++) {
        var event = events[k]; %>

        #<%= event.id %>:checked ~ .calendar-detail .<%= event.id %> {
            display: block;
        }

        #<%= event.id %>:checked ~ .calendars .calendar-nojs label[for="<%= event.id %>"] {
            background-color: red;
        }
    <% } %>

    

    </style>

    <% for(var k=0; k<months.length; k++) {
        var context = months[k];
        if (k===0) { %>
            <input checked type="radio" name="radio-group" id="<%= context.monthId %>">
        <% } else { %>
            <input type="radio" name="radio-group" id="<%= context.monthId %>">
        <% } %>
    <% } %>

    <% for(var k=0; k<events.length; k++) {
        var event = events[k];

        if (k===0) { %>
            <input  type="radio" name="radio-event" id="<%= event.id %>">
        <% } else { %>
            <input checked type="radio" name="radio-event" id="<%= event.id %>">
        <% } %>
    <% } %>

    <div class="calendars">
        <!-- this is used for the month selection -->
        <div class="calendars-controls">
            <div>
                <% for(var k=0; k<months.length; k++) {
                    var context = months[k]; %>
                    <label for="<%= context.monthId %>"></label>
                <% } %>
            </div>
        </div>
        <div class="calendars-inner">
        <!-- display all months calendar -->
        <% for(var k=0; k<months.length; k++) {
            var context = months[k]; %>
            <div class="calendar-nojs">
                <h2><%= context.monthTitle %></h2>
                <table>
                    <thead>
                        <tr>
                            <% for(var i=context.firstDayOfWeek; i<(context.weekdays.length+context.firstDayOfWeek); i++) { %>
                                <td><%= context.weekdays[i % 7] %></td>
                            <% } %>
                        </tr>
                    </thead>
                    <tbody>
                    <% for(var i=0; i<context.nWeeks; i++) { %>
                        <tr>
                            <% for(var j=0; j<7; j++) {
                                var curDate = context.range.start;
                                var curMonth = curDate.month();

                                if (curMonth === context.month-1) { %>
                                    <td class="previous-month"><%= curDate.date() %></td>
                                <% } else if (curMonth === context.month+1) { %>
                                    <td class="next-month"><%= curDate.date() %></td>
                                <% } else {

                                    const selectedEvents = events.filter(function(event) {
                                        if (!event.date.diff(curDate, 'minutes')) {
                                            return true;
                                        }
                                    });

                                    if (selectedEvents.length > 1) {
                                        /* TODO: we need to group all events for a day */
                                        /* so the selector shoud be a day selector */
                                        /* and not an event selector */
                                        console.log(selectedEvent);
                                    }

                                    if (selectedEvents.length) { %>
                                        <td><label class="event" for="<%= selectedEvents[0].id %>"><%= curDate.date() %></label></td>
                                    <% } else { %>
                                        <td><label><%= curDate.date() %></td>
                                    <% }
                                } %>
                                <% context.range.start.add(1, 'days');
                            } %>
                        </tr>
                    <% } %>
                    </tbody>
                </table>
            </div>
        <% } %>
        </div>
    </div>
    <!-- display all events for a day -->
    <div class='calendar-detail'>
         <% for(var k=0; k<events.length; k++) {
            var event = events[k]; %>
            <div class="<%= event.id %>">
                <div class="event__name"><h2><%= event.name %></h2></div>
                <div class="event_description"><%= event.description %></div>
            </div>
        <% } %>
    </div>
</body>
</html>

